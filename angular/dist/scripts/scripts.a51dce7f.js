"use strict";var app=angular.module("carpoolingApp",["ngAnimate","ngAria","ngCookies","ngMessages","ngResource","ngRoute","ngSanitize","ngTouch","angularTrix","ae-datetimepicker","ngMap"]);app.config(["$routeProvider","$httpProvider",function(a,b){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl",controllerAs:"main"}).when("/blog",{templateUrl:"views/blog.html",controller:"BlogCtrl",controllerAs:"blog"}).when("/blogItem/:id",{templateUrl:"views/blogitem.html",controller:"BlogitemCtrl",controllerAs:"blogItem"}).when("/user",{templateUrl:"views/user.html",controller:"UserCtrl",controllerAs:"user"}).when("/userEdit",{templateUrl:"views/useredit.html",controller:"UsereditCtrl",controllerAs:"userEdit"}).when("/routes",{templateUrl:"views/routes.html",controller:"RoutesCtrl",controllerAs:"routes"}).when("/route/:id",{templateUrl:"views/route.html",controller:"RouteCtrl",controllerAs:"route"}).when("/login",{templateUrl:"views/login.html",controller:"LoginCtrl",controllerAs:"login"}).when("/register",{templateUrl:"views/register.html",controller:"RegisterCtrl",controllerAs:"register"}).when("/logout",{templateUrl:"views/logout.html",controller:"LogoutCtrl",controllerAs:"logout"}).when("/addBlog",{templateUrl:"views/addblog.html",controller:"AddblogCtrl",controllerAs:"addBlog"}).when("/addRoute",{templateUrl:"views/addroute.html",controller:"AddrouteCtrl",controllerAs:"addRoute"}).otherwise({redirectTo:"/"}),b.defaults.withCredentials=!0}]),app.run(["userService",function(a){a.isLogged()}]),angular.module("carpoolingApp").controller("MainCtrl",["userService","$scope",function(a,b){a.isLogged(),console.log(b)}]),angular.module("carpoolingApp").service("myservice",function(){this.myFunction=function(){console.log("myFunction")}}),angular.module("carpoolingApp").service("userService",["$rootScope","$http",function(a,b){var c=window.location.protocol+"//"+window.location.hostname;this.login=function(d,e){b({method:"POST",url:c+":5000/user/login",data:d}).then(function(b){"OK"===b.data.status?(a.userId=b.data.data.user,a.userLogin=b.data.data.login,a.userLogged=!0,e(!0)):(window.alert(b.data.data.message),e(!1))},function(){window.alert("An error occured, please try again"),e(!1)})},this.isLogged=function(){return a.checkedLogin?a.userLogged:(b({method:"GET",url:c+":5000/user/logged"}).then(function(b){var c=b.data.logged,d=b.data.uid;return a.userId=d,a.userLogged=c,a.checkedLogin=!0,c},function(){return!1}),!1)},this.logout=function(){b({method:"GET",url:c+":5000/user/logout"}).then(function(){a.userId="",a.userLogged=!1,a.userLogin=""},function(){window.alert("An error occured, please try again")})}}]),angular.module("carpoolingApp").controller("BlogCtrl",["$scope","blogService",function(a,b){b.blog(function(b){b&&(a.blogS=b)})}]),angular.module("carpoolingApp").controller("BlogitemCtrl",["$scope","blogService","userService","$routeParams",function(a,b,c,d){c.isLogged()&&(a.id=d.id,b.getPost(a.id,function(b){b&&(a.post=b)}))}]),angular.module("carpoolingApp").controller("UserCtrl",function(){this.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}),angular.module("carpoolingApp").controller("UsereditCtrl",function(){this.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}),angular.module("carpoolingApp").controller("RoutesCtrl",["$scope","routesService",function(a,b){b.routeS(function(b){b&&(a.recRoutes=b)})}]),angular.module("carpoolingApp").controller("RouteCtrl",["$scope","routesService","$routeParams","NgMap",function(a,b,c,d){a.id=c.id,b.getRoute(a.id,function(b,c){b&&(a.route=b,d.getMap().then(function(b){a.rq={origin:a.route.route_from,destination:a.route.route_to,travelMode:google.maps.DirectionsTravelMode.DRIVING}})),c&&(a.passengers=c)}),a.ical=function(){window.open(window.location.protocol+"//"+window.location.hostname+":5000/routes/ical/"+a.id)},a.join=function(){b.joinRoute(a.id,function(a){a&&window.location.reload()})},a.leave=function(){b.leaveRoute(a.id,function(a){a&&window.location.reload()})}}]),angular.module("carpoolingApp").controller("LoginCtrl",["$scope","userService","$location",function(a,b,c){b.isLogged()&&c.path("/"),a.validate=function(d){if(d.$valid){var e={email:a.email,password:a.password};b.login(e,function(a){a&&c.path("/")})}}}]),angular.module("carpoolingApp").controller("RegisterCtrl",["$scope","userService","registerService","$location",function(a,b,c,d){b.isLogged()&&d.path("/"),a.validate=function(b){if(b.$valid){var e={email:a.email,password:a.password,login:a.login,car:a.car,plates:a.plates,desc:a.desc};c.register(e,function(a){a&&d.path("/")})}}}]),angular.module("carpoolingApp").controller("LogoutCtrl",["$location","userService",function(a,b){b.logout(),a.path("/")}]),angular.module("carpoolingApp").service("registerService",["$http","$rootScope",function(a,b){var c=window.location.protocol+"//"+window.location.hostname;this.register=function(d,e){a({method:"POST",url:c+":5000/user/register",data:d}).then(function(a){"OK"===a.data.status?(console.log(a),b.userId=a.data.data.user,b.userLogin=a.data.data.login,b.userLogged=!0,e(!0)):(window.alert("An error occured, please try again: "+a.data.data.message),e(!1))},function(){window.alert("An error occured, please try again"),e(!1)})}}]),angular.module("carpoolingApp").service("blogService",["$rootScope","$http",function(a,b){var c=window.location.protocol+"//"+window.location.hostname;this.blog=function(d){b({method:"GET",url:c+":5000/blog"}).then(function(b){if("OK"===b.data.status){a.posts=b.data.data.posts;for(var c=0;c<a.posts.length;c++)a.posts[c].dateObj=new Date(a.posts[c].date);d(a.posts)}},function(){window.alert("An error occured, please try again"),d(!1)})},this.save=function(a,d){b({method:"POST",url:c+":5000/blog/save",data:a}).then(function(a){"OK"===a.data.status?d(a.data.data.id):(window.alert(a.data.data.message),d(!1))},function(){window.alert("An error occured, please try again"),d(!1)})},this.getPost=function(a,d){b({method:"GET",url:c+":5000/blog/post/"+a}).then(function(a){"OK"===a.data.status&&(a.data.data.dateObj=new Date(a.data.data.date),d(a.data.data))},function(){window.alert("An error occured, please try again"),d(!1)})}}]),angular.module("carpoolingApp").service("routesService",["$rootScope","$http",function(a,b){var c=window.location.protocol+"//"+window.location.hostname;this.routeS=function(a){b({method:"GET",url:c+":5000/routes"}).then(function(b){if("OK"===b.data.status){for(var c=0;c<b.data.data.routes.length;c++)b.data.data.routes[c].dateObj=new Date(b.data.data.routes[c].date);a(b.data.data.routes)}},function(){window.alert("An error occured, please try again"),a(!1)})},this.getRoute=function(a,d){b({method:"GET",url:c+":5000/routes/"+a}).then(function(a){if("OK"===a.data.status){var b=a.data.data.route;b.dateObj=new Date(b.date),d(b,a.data.data.passengers)}},function(){window.alert("An error occured, please try again"),d(!1)})},this.joinRoute=function(a,d){b({method:"POST",url:c+":5000/routes/join",data:{route_id:a}}).then(function(a){"OK"===a.data.status&&d(!0)},function(){window.alert("An error occured, please try again"),d(!1)})},this.leaveRoute=function(a,d){b({method:"POST",url:c+":5000/routes/leave",data:{route_id:a}}).then(function(a){"OK"===a.data.status&&d(!0)},function(){window.alert("An error occured, please try again"),d(!1)})},this.save=function(a,d){b({method:"POST",url:c+":5000/routes/add",data:a}).then(function(a){"OK"===a.data.status?d(a.data.data.id):(window.alert(a.data.data.message),d(!1))},function(){window.alert("An error occured, please try again"),d(!1)})}}]),angular.module("carpoolingApp").controller("AddblogCtrl",["$scope","blogService","userService","$location",function(a,b,c,d){a.validate=function(c){if(c.$valid){var e={title:a.title,text:a.text};b.save(e,function(a){if(a){var b="/blogItem/"+a;d.path(b)}})}}}]),angular.module("carpoolingApp").controller("AddrouteCtrl",["$scope","routesService","userService","$location",function(a,b,c,d){a.validate=function(c){if(c.$valid){var e={route_from:a.route_from,route_to:a.route_to,date:a.date.format("YYYY-MM-DD HH:mm:ss"),max_passengers:a.max_passengers,desc_route:a.desc_route,price:a.price};b.save(e,function(a){if(a){var b="/route/"+a;d.path(b)}})}},a.options={format:"YYYY-MM-DD HH:mm:ss"}}]),angular.module("carpoolingApp").run(["$templateCache",function(a){a.put("views/addblog.html",'<div class="container"> <h1> Dodaj nowego bloga</h1> <div class="row"> <div class="col-md-6" style="float:none; margin; 0 auto"> <form name="newPost" ng-submit="validate(newPost)"> <div class="form-group"> <label class="control-label" ng-show="userLogged">Tytuł</label> <input type="text" name="title" ng-model="title" ng-required="true" required class="form-control" ng-show="userLogged"> <span class="error" ng-show="newPost.title.$error.required && newPost.title.$touched"> Pole wymagane!</span> </div> <div class="form-group"> <label class="control-label" ng-show="userLogged">Tekst</label> <trix-editor angular-trix ng-model="text"></trix-editor> <span class="error" ng-show="newPost.text.$error.required && newPost.text.$touched"> Pole wymagane!</span> </div> <div class="form-group"> <button type="submit" class="btn btn-primary" ng-show="userLogged"> Add </button> </div> </form> </div> </div> </div>'),a.put("views/addroute.html",'<div class="container"> <h1> Dodaj nowa trase</h1> <div class="row"> <div class="col-md-6" style="float:none; margin; 0 auto"> <form name="newRoute" ng-submit="validate(newRoute)"> <div class="form-group"> <label class="control-label">Start trasy</label> <input type="text" name="route_from" ng-model="route_from" ng-required="true" required class="form-control"> <span class="error" ng-show="newRoute.route_from.$error.required && newRoute.route_from.$touched"> Pole wymagane!</span> </div> <div class="form-group"> <label class="control-label">Koniec trasy</label> <input type="text" name="route_to" ng-model="route_to" ng-required="true" required class="form-control"> <span class="error" ng-show="newRoute.route_to.$error.required  && newRoute.route_to.$touched"> Pole wymagane!</span> </div> <div class="form-group"> <label class="control-label">Data wyjazdu</label> <input type="text" datetimepicker options="options" name="date" ng-model="date" ng-required="true" required class="form-control"> <span class="error" ng-show="newRoute.date.$error.required && newRoute.date.$touched"> Pole wymagane!</span> </div> <div class="form-group"> <label class="control-label">Liczba pasażerów</label> <input type="number" name="max_passengers" ng-model="max_passengers" ng-required="true" required class="form-control"> <span class="error" ng-show="newRoute.max_passengers.$error.required && newRoute.max_passengers"> Pole wymagane!</span> </div> <div class="form-group"> <label class="control-label">Cena</label> <input type="text" name="price" ng-model="price" ng-required="true" required class="form-control"> <span class="error" ng-show="newRoute.price.$error.required && newRoute.price.$touched"> Pole wymagane!</span> </div> <div class="form-group"> <label class="control-label">Opis</label> <trix-editor angular-trix ng-model="desc_route" ng-required="true"></trix-editor> <span class="error" ng-show="newRoute.desc_route.$error.required"> Pole wymagane!</span> </div> <div class="form-group"> <button type="submit" class="btn btn-primary" ng-disabled="newRoute.$invalid"> Add </button> </div> </form> </div> </div> </div>'),a.put("views/blog.html",'<div class="container"> <div class="jumbotron"> <h1>Blog</h1> <p>Przeczytaj posty dostępne na naszym blogu.</p> <p>Blog ten jest tworzony przez naszych użytkowników</p> </div> <ul class="list-group"> <li class="list-group-item" ng-repeat="x in blogS"> <a href="#/blogItem/{{x.blog_id}}" class="block-item clearfix"> {{x.title}} <span class="pull-right"> {{x.dateObj | date : \'yyyy-MM-dd HH:mm\'}}</span> </a> </li> </ul> </div>'),a.put("views/blogitem.html",'<div class="container"> <div class="page-header"> <h1>{{post.title}}</h1> </div> <div class="clearfix"> Napisany przez: {{ post.login }} <span class="pull-right"> Data: {{ post.dateObj | date : \'yyyy-MM-dd HH:mm\'}} </span> </div> <div class="post-content" style="margin-top: 20px; margin-bottom: 50px" ng-bind-html="post.text"></div> </div>'),a.put("views/login.html",'<div class="row"> <div class="col-md-6" style="float:none; margin; 0 auto"> <h3>Login</h3> <form name="loginForm" ng-submit="validate(loginForm)"> <div class="form-group"> <label class="control-label">Email</label> <input type="email" name="email" ng-model="email" ng-required="true" required class="form-control"> <span class="error" ng-show="loginForm.email.$error.required && loginForm.email.$touched"> Required!</span> <span class="error" ng-show="loginForm.email.$error.email && loginForm.email.$touched"> Not valid email!</span> </div> <div class="form-group"> <label class="control-label">Password</label> <input type="password" name="password" ng-model="password" ng-required="true" required class="form-control"> <span class="error" ng-show="loginForm.password.$error.required && loginForm.password.$touched"> Required!</span> </div> <hr> <div class="form-group"> <button type="submit" class="btn btn-primary"> Login </button> </div> </form> </div> </div>'),a.put("views/logout.html","<p>This is the logout view.</p>"),a.put("views/main.html",'<div class="container"> <div class="row"> <div class="col-md-6"> <img src="images/car.9acc6a40.jpg" class="img-responsive"> </div> <div class="col-md-6"> <div class="jumbotron"> <h1>Jedziesz gdzieś swoim samochodem?</h1> <p>Dzięki wspólnym przejazdom z Carpooling app możesz zaoszczędzić na paliwie, podróżując w miłej atmosferze.</p> <p><a class="btn btn-primary btn-lg" href="#/routes" role="button">Wyszukaj przejazdy</a></p> </div> </div> </div> </div>'),a.put("views/register.html",'<div class="row"> <div class="col-md-6" style="float:none; margin; 0 auto"> <h3>Register</h3> <form name="regiForm" ng-submit="validate(regiForm)"> <div class="form-group"> <label class="control-label">Email</label> <input type="email" name="email" ng-model="email" ng-required="true" required class="form-control"> <span class="error" ng-show="regiForm.email.$error.required && regiForm.email.$touched"> Required!</span> <span class="error" ng-show="regiForm.email.$error.email  && regiForm.email.$touched"> Not valid email!</span> </div> <div class="form-group"> <label class="control-label">Password</label> <input type="password" name="password" ng-model="password" ng-required="true" required class="form-control"> <span class="error" ng-show="regiForm.password.$error.required && regiForm.password.$touched"> Required!</span> </div> <div class="form-group"> <label class="control-label">Login</label> <input type="text" name="login" ng-model="login" ng-required="true" required class="form-control"> <span class="error" ng-show="regiForm.login.$error.required && regiForm.login.$touched"> Required!</span> </div> <div class="form-group"> <label class="control-label">Car</label> <input type="text" name="car" ng-model="car" ng-required="true" required class="form-control"> <span class="error" ng-show="regiForm.car.$error.required && regiForm.car.$touched"> Required!</span> </div> <div class="form-group"> <label class="control-label">Plates</label> <input type="text" name="plates" ng-model="plates" ng-required="true" required class="form-control"> <span class="error" ng-show="regiForm.plates.$error.required && regiForm.plates.$touched"> Required!</span> </div> <div class="form-group"> <label class="control-label">Description</label> <input type="text" name="desc" ng-model="desc" ng-required="true" required class="form-control"> <span class="error" ng-show="regiForm.desc.$error.required && regiForm.desc.$touched"> Required!</span> </div> <div class="form-group"> <button type="submit" class="btn btn-primary"> Register </button> </div> </form> </div> </div>'),a.put("views/route.html",'<div class="container"> <div class="page-header"> <h3> Trasa {{ route.route_from}} do {{ route.route_to }}</h3> <p>Data przejazdu: {{ route.dateObj | date : \'yyyy-MM-dd HH:mm\' }}</p> </div> <div class="row"> <div class="col-md-6"> <div class="panel panel-default"> <div class="panel-heading">Dane kierowcy</div> <div class="panel-body"> <p>Login: {{ route.login }}</p> <p>Cena za przejazd: {{ route.price }}</p> <p>Liczba pasażerów: {{ route.passengers }}</p> <p>Maksymalna liczba pasażerów: {{ route.max_passengers }}</p> <p>Auto: {{ route.car }}</p> <p>Numer rejestracyjny auta: {{ route.plates }}</p> <p>Opis kierowcy: {{ route.desc }}</p> <p>Opis trasy:</p> <div ng-bind-html="route.desc_route"></div> </div> </div> <div class="buttons" style="margin: 15px 0"> <button ng-if="!route.user_joined" type="button" class="btn btn-default" ng-click="join()">Dołącz do kierowcy</button> <button ng-if="route.user_joined" type="button" class="btn btn-primary" ng-click="ical()">Pobierz plik kalendarza </button> <button ng-if="route.user_joined" type="button" class="btn btn-danger" ng-click="leave()">Zrezygnuj z przejazdu </button> </div> </div> <div class="col-md-6"> <ng-map center="[40.74, -74.18]" default-style="false" style="height: 450px; display: block"> <directions draggable="true" travel-mode="{{rq.travelMode}}" origin="{{rq.origin}}" destination="{{rq.destination}}"> </directions> </ng-map> </div> </div> </div>'),a.put("views/routes.html",'<div class="container"> <div class="jumbotron"> <h2>Lista dostępnych wycieczek</h2> <p>Chcesz szybko tanio i bezpiecznie dostać się z punktu A do B?</p> <p>Nic prostszego! Przejrzyj listę dostępnych tras i załatw sobie transport!</p> </div> <ul class="list-group"> <li class="list-group-item" ng-repeat="x in recRoutes"> <a href="#/route/{{x.route_id}}" class="block-item clearfix"> <span class="inline-block">{{x.route_from}} </span> <span ng-if="x.can_book == true" class="label label-success">Wolne miejsca!</span> <span ng-if="x.can_book != true" class="label label-danger">Brak miejsc!</span> <span class="pull-right"> {{x.dateObj | date : \'yyyy-MM-dd HH:mm\'}}</span> </a> </li> </ul> </div>'),a.put("views/user.html","<p>This is the user view.</p>"),a.put("views/useredit.html","<p>This is the userEdit view.</p>")}]);